class Solution(object):
    def hitBricks(self, grid, hits):
        rows, cols = len(grid), len(grid[0]) # Задаем длину строк и колонок

        def is_valid(r, c): # Функция для проверки валидности координатов кирпичей
            return 0 <= r < rows and 0 <= c < cols

        def is_connected_to_top(r, c): # Проверка на устойчивость кирпича
            # Кирпич соединён с верхней строкой
            return r == 0 or any(
                (is_valid(r + dr, c + dc) and grid[r + dr][c + dc] == 2) for dr, dc in [(-1, 0), (1, 0), (0, -1), (0, 1)])
            # Если r = 0, то это означает, что кирпич присоединен к верхней границе -> устойчивый
            # any: если хотя бы один из соседов присоединен является устойчивым (== 2), то выдает True
            # Массив справа: координаты, которые плюсуем к r и c, чтобы получить соседний кирпич

        def dfs(r, c): # Поиск в глубину
            # Запускаем DFS, чтобы пометить все устойчивые кирпичи
            if not is_valid(r, c) or grid[r][c] != 1:
                return 0

            grid[r][c] = 2  # Помечаем кирпич как устойчивый
            count = 1  # Текущий кирпич

            for dr, dc in [(-1, 0), (1, 0), (0, -1), (0, 1)]: # координаты, для соседей устойчивых кирпичей
                count += dfs(r + dr, c + dc) # Вызов рекурсии, для поиска в глубину для нахождения и отметки всех устойчивых кирпичей

            return count # Возвращаем количество устойчивых кирпичей

        # Шаг 1: Помечаем удалённые кирпичи
        for r, c in hits:
            if grid[r][c] == 1:
                grid[r][c] = -1

        # Шаг 2: Определяем устойчивые кирпичи
        for c in range(cols):
            dfs(0, c)

        # Шаг 3: Обрабатываем массив hits в обратном порядке
        result = []
        for r, c in reversed(hits):
            if grid[r][c] == -1:  # Восстанавливаем кирпич
                grid[r][c] = 1
                if is_connected_to_top(r, c):
                    # Подсчитываем, сколько кирпичей добавлено к устойчивым
                    result.append(dfs(r, c) - 1)
                else:
                    result.append(0)
            else:
                result.append(0)

        return result[::-1]
